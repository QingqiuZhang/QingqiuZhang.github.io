<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    Qingqiu Zhang
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="Qingqiu Zhang">
<meta name="description" content="Thank you for visiting. Have fun here!">
<meta name="keywords" content="qingqiu zhang, machine learning, Qingqiu Zhang">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="https://qingqiuzhang.github.io/styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
        
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
                                <script async src="https://www.googletagmanager.com/gtag/js?id=UA-224309801-1"></script>
                                <script>
                                    window.dataLayer = window.dataLayer || [];

                                    function gtag() {
                                        dataLayer.push(arguments);
                                    }
                                    gtag('js', new Date());
                                    gtag('config', 'UA-224309801-1');
                                </script>
                                
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://qingqiuzhang.github.io">
                    Qingqiu Zhang
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        Home
                    </a>
                    
                    <a class="menu-item" href="/posts">
                        Content
                    </a>
                    
                    <a class="menu-item" href="https://qingqiuzhang.github.io/archives">
                        Archives
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        Tag
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://qingqiuzhang.github.io">
                            Qingqiu Zhang
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            Home
                        </a>
                        
                        <a class="menu-item" href="/posts">
                            Content
                        </a>
                        
                        <a class="menu-item" href="https://qingqiuzhang.github.io/archives">
                            Archives
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            Tag
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>

            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                Retail Data Anlytics (1) -- Data Preprocessing
                            </h1>
                            
                                <!--en-->
                                <div class="post-meta en">
                                    Author:
                                    <a itemprop="author" rel="author" href="/">
                                        Qingqiu Zhang
                                    </a>
                                    <span class="post-time">
                                        Date: <a href="#">
                                            2022-04-03
                                        </a>
                                    </span>
                                    
                                </div>
                                
                        </header>
                        
                                <div class="post-content">
                                    <p>In this article, I will demonstrate how to an end-to-end machine learning project using diverse regression models. I will explore retail data and using some features to predict future weekly sale. The whole procedure including data preprocessing, training various models, evaluating models and testing on an unseen dataset.<br>
<strong>In case you need the source data, visit this webpage:</strong><br>
<a href="https://www.kaggle.com/datasets/manjeetsingh/retaildataset">Data Source</a></p>
<!-- more -->
<h1 id="exploring-data">Exploring Data</h1>
<p>The meaning of each column is stated as below:</p>
<blockquote>
<ul>
<li>Store: the store number</li>
<li>Date: the week</li>
<li>Temperature: average temperature in the region</li>
<li>Fuel_Price: cost of fuel in the region</li>
<li>MarkDown1-5: anonymized data related to promotional markdowns. MarkDown data is only available after Nov 2011, and is not available for all stores all the time. Any missing value is marked with an NA</li>
<li>CPI: the consumer price index</li>
<li>Unemployment: the unemployment rate</li>
</ul>
</blockquote>
<h2 id="stores">Stores</h2>
<pre><code class="language-Python">import pandas as pd
stores = pd.read_csv(&quot;stores data-set.csv&quot;)
stores.shape
stores.head(10)
</code></pre>
<pre>(45, 3)</pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store</th>
      <th>Type</th>
      <th>Size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>A</td>
      <td>202307</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>B</td>
      <td>37392</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>A</td>
      <td>205863</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>B</td>
      <td>34875</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>A</td>
      <td>202505</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>B</td>
      <td>70713</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>A</td>
      <td>155078</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>B</td>
      <td>125833</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>B</td>
      <td>126512</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-Python"># if any null values
stores.isnull().sum()
</code></pre>
<pre>Store    0
Type     0
Size     0
dtype: int64</pre>
<pre><code class="language-Python">stores.info()
</code></pre>
<pre>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 45 entries, 0 to 44
Data columns (total 3 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   Store   45 non-null     int64 
 1   Type    45 non-null     object
 2   Size    45 non-null     int64 
dtypes: int64(2), object(1)
memory usage: 1.2+ KB
</pre>
<pre><code class="language-Python">stores.describe()
</code></pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store</th>
      <th>Size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>45.000000</td>
      <td>45.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>23.000000</td>
      <td>130287.600000</td>
    </tr>
    <tr>
      <th>std</th>
      <td>13.133926</td>
      <td>63825.271991</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>34875.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>12.000000</td>
      <td>70713.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>23.000000</td>
      <td>126512.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>34.000000</td>
      <td>202307.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>45.000000</td>
      <td>219622.000000</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-Python">from pyecharts import options as opts
from pyecharts.charts import Bar

# how many stores each type
store_num_by_type = stores.iloc[:, :2].groupby(&quot;Type&quot;, as_index = False).count()
bar_store_num_by_type = (
    Bar(init_opts = opts.InitOpts(width = &quot;300px&quot;, height = &quot;300px&quot;))
    .add_xaxis(list(store_num_by_type[&quot;Type&quot;]))
    .add_yaxis(&quot;Store Number&quot;, list(store_num_by_type[&quot;Store&quot;]), category_gap = &quot;50%&quot;)
)
bar_store_num_by_type.render_notebook()
</code></pre>
<iframe scrolling="no" allowfullscreen="true" width="100%" height="300px" frameborder="no" src="../post-images/Bar Store Num by Type.html" >
</iframe>
<pre><code class="language-Python">from pyecharts.charts import Scatter, Boxplot, Line, Grid, Tab

# relationship between type and size
# guess: the bigger the size, the higher the weekly sales.

types = [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]
names = locals()

# scatter plot
for val in types: 
    names[str(val)] = (
        Scatter(init_opts = opts.InitOpts(width = &quot;250px&quot;, height = &quot;250px&quot;))
        .add_xaxis(stores.loc[stores[&quot;Type&quot;] == val][&quot;Store&quot;].to_list())
        .add_yaxis(f&quot;Type{val}&quot;, stores.loc[stores[&quot;Type&quot;] == val][&quot;Size&quot;].to_list())
        .set_global_opts(
            title_opts  = opts.TitleOpts(
                pos_left = &quot;10%&quot;, title = &quot;Store Size Boxplot by Type&quot;
            ),
            xaxis_opts  = opts.AxisOpts(type_ = &quot;value&quot;, name = &quot;Store&quot;),
            yaxis_opts  = opts.AxisOpts(type_ = &quot;value&quot;, name = &quot;Size&quot;, is_scale = True),
            legend_opts = opts.LegendOpts(
                pos_left = &quot;42%&quot;, align = &quot;left&quot;, orient = &quot;vertical&quot;
            ),
        )
        .set_series_opts(label_opts = opts.LabelOpts(is_show = False))
    )
overlap = A.overlap(B).overlap(C)

# boxplot
boxplot = Boxplot(init_opts = opts.InitOpts(width = &quot;250px&quot;, height = &quot;250px&quot;))
y_axis = [
    list(stores.loc[stores[&quot;Type&quot;] == &quot;A&quot;][&quot;Size&quot;]),
    list(stores.loc[stores[&quot;Type&quot;] == &quot;B&quot;][&quot;Size&quot;]),
    list(stores.loc[stores[&quot;Type&quot;] == &quot;C&quot;][&quot;Size&quot;]),
]
boxplot_store_size_by_type = boxplot.add_xaxis(
    [&quot;Type A&quot;, &quot;Type B&quot;, &quot;Type C&quot;]
).add_yaxis(&quot;&quot;, boxplot.prepare_data(y_axis))
boxplot_store_size_by_type.set_global_opts(
    title_opts = opts.TitleOpts(pos_left = &quot;60%&quot;, title = &quot;Store Size Scatter Plot&quot;),
    xaxis_opts = opts.AxisOpts(type_ = &quot;category&quot;, name = &quot;Type&quot;),
    yaxis_opts = opts.AxisOpts(type_ = &quot;value&quot;, name = &quot;Size&quot;, is_scale = True),
)

# combine the plots
grid = (
    Grid(init_opts=opts.InitOpts(width=&quot;800px&quot;, height=&quot;400px&quot;))
    .add(overlap, grid_opts=opts.GridOpts(pos_left=&quot;58%&quot;))
    .add(boxplot_store_size_by_type, grid_opts=opts.GridOpts(pos_right=&quot;58%&quot;))
)
grid.render_notebook()
# Normally type A has the largest size and type c has the smallest.

</code></pre>
<iframe allowfullscreen="true" width="100%" height="450px" frameborder="no" src="../post-images/Boxplot & Scatter Store Size by Type.html" >
</iframe>
<h2 id="sales">Sales</h2>
<pre><code class="language-Python">sales = pd.read_csv(&quot;sales data-set.csv&quot;)
# The format of date is DD/MM/YYYY
sales.Date = pd.to_datetime(sales.Date, dayfirst=True)
sales.shape
sales.head(10)
</code></pre>
<pre>(421570, 5)</pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store</th>
      <th>Dept</th>
      <th>Date</th>
      <th>Weekly_Sales</th>
      <th>IsHoliday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>24924.50</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td nowrap="nowrap">2010-02-12</td>
      <td>46039.49</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td nowrap="nowrap">2010-02-19</td>
      <td>41595.55</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td nowrap="nowrap">2010-02-26</td>
      <td>19403.54</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>1</td>
      <td nowrap="nowrap">2010-03-05</td>
      <td>21827.90</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>1</td>
      <td nowrap="nowrap">2010-03-12</td>
      <td>21043.39</td>
      <td>False</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>1</td>
      <td nowrap="nowrap">2010-03-19</td>
      <td>22136.64</td>
      <td>False</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>1</td>
      <td nowrap="nowrap">2010-03-26</td>
      <td>26229.21</td>
      <td>False</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>1</td>
      <td nowrap="nowrap">2010-04-02</td>
      <td>57258.43</td>
      <td>False</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>1</td>
      <td nowrap="nowrap">2010-04-09</td>
      <td>42960.91</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-Python">sales.isnull().sum()
</code></pre>
<pre>Store           0
Dept            0
Date            0
Weekly_Sales    0
IsHoliday       0
dtype: int64</pre>
<pre><code class="language-Python">sales.info()
</code></pre>
<pre>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 421570 entries, 0 to 421569
Data columns (total 5 columns):
 #   Column        Non-Null Count   Dtype         
---  ------        --------------   -----         
 0   Store         421570 non-null  int64         
 1   Dept          421570 non-null  int64         
 2   Date          421570 non-null  datetime64[ns]
 3   Weekly_Sales  421570 non-null  float64       
 4   IsHoliday     421570 non-null  bool          
dtypes: bool(1), datetime64[ns](1), float64(1), int64(2)
memory usage: 13.3 MB
</pre>
<pre><code class="language-Python">sales.describe()
</code></pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store</th>
      <th>Dept</th>
      <th>Weekly_Sales</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>421570.000000</td>
      <td>421570.000000</td>
      <td>421570.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>22.200546</td>
      <td>44.260317</td>
      <td>15981.258123</td>
    </tr>
    <tr>
      <th>std</th>
      <td>12.785297</td>
      <td>30.492054</td>
      <td>22711.183519</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-4988.940000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>11.000000</td>
      <td>18.000000</td>
      <td>2079.650000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>22.000000</td>
      <td>37.000000</td>
      <td>7612.030000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>33.000000</td>
      <td>74.000000</td>
      <td>20205.852500</td>
    </tr>
    <tr>
      <th>max</th>
      <td>45.000000</td>
      <td>99.000000</td>
      <td>693099.360000</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-Python"># Average Weekly Dept Sales in each Store

# holiday
mean_dept_sales_H = (
    sales.loc[sales[&quot;IsHoliday&quot;] == True]
    .groupby([&quot;Store&quot;, &quot;Dept&quot;], as_index=False)
    .mean()
)

# non-holiday
mean_dept_sales_NH = (
    sales.loc[sales[&quot;IsHoliday&quot;] == False]
    .groupby([&quot;Store&quot;, &quot;Dept&quot;], as_index = False)
    .mean()
)

store_dept = sales[[&quot;Store&quot;, &quot;Dept&quot;]].drop_duplicates()
store_list = sorted(set(store_dept.Store.to_list()))
names      = locals()
tab        = Tab()

# bar chart
for store in store_list: 
    names[str(store)] = (
        Bar(init_opts = opts.InitOpts(width = &quot;700px&quot;, height = &quot;400px&quot;))
        .add_xaxis(store_dept.loc[store_dept[&quot;Store&quot;] == store][&quot;Dept&quot;].to_list())
        .add_yaxis(
            &quot;Holiday&quot;,
            mean_dept_sales_H.loc[mean_dept_sales_H[&quot;Store&quot;] == store][
                &quot;Weekly_Sales&quot;
            ].to_list(),
            stack = &quot;stack1&quot;,
        )
        .add_yaxis(
            &quot;Not Holiday&quot;,
            mean_dept_sales_NH.loc[mean_dept_sales_NH[&quot;Store&quot;] == store][
                &quot;Weekly_Sales&quot;
            ].to_list(),
            stack = &quot;stack1&quot;,
        )
        .set_series_opts(label_opts = opts.LabelOpts(is_show = False))
        .set_global_opts(
            title_opts = opts.TitleOpts(
                pos_left = &quot;left&quot;,
                title    = f&quot;Department Average Weekly Sales of Store {store}&quot;,
            ),
            datazoom_opts = [opts.DataZoomOpts(), opts.DataZoomOpts(type_ = &quot;inside&quot;)],
            xaxis_opts    = opts.AxisOpts(name=&quot;Department&quot;),
            yaxis_opts    = opts.AxisOpts(
                name = &quot;Avg. Weekly Sales&quot;, is_scale = True, min_interval = 20000
            ),
            legend_opts = opts.LegendOpts(
                pos_left = &quot;80%&quot;, pos_top = &quot;top&quot;, align = &quot;left&quot;, orient = &quot;vertical&quot;
            ),
        )
    )
    tab = tab.add(names[str(store)], f&quot;Store {store}&quot;)
tab.render_notebook()

# Switch between tabs to see department average weekly sales of each store
# Zoom the barplot in or drag the zoom window below the barplot to concentrate on specific departmentsHo
# Click on legend to see Holiday or Non Holiday sales
</code></pre>
<iframe allowfullscreen="true" width="100%" height="630px" frameborder="no" src="../post-images/Store Avg Weekly Sales by Dept in Holidays and Nonholidays.html" >
</iframe>
<p>Different department plays different roles. At some departments, the sales on holidays are much higher than the other days. While some other department vice versa.</p>
<pre><code class="language-Python"># Average Weekly Dept Sales of All Stores
dept_list = sorted(set(store_dept.Dept.to_list()))
names     = locals()
tab       = Tab()

for dept in dept_list: 
    names[str(dept)] = (
        Bar(init_opts = opts.InitOpts(width = &quot;700px&quot;, height = &quot;400px&quot;))
        .add_xaxis(store_dept.loc[store_dept[&quot;Dept&quot;] == dept][&quot;Store&quot;].to_list())
        .add_yaxis(
            &quot;Holiday&quot;,
            mean_dept_sales_H.loc[mean_dept_sales_H[&quot;Dept&quot;] == dept][
                &quot;Weekly_Sales&quot;
            ].to_list(),
            stack = &quot;stack1&quot;,
        )
        .add_yaxis(
            &quot;Not Holiday&quot;,
            mean_dept_sales_NH.loc[mean_dept_sales_NH[&quot;Dept&quot;] == dept][
                &quot;Weekly_Sales&quot;
            ].to_list(),
            stack = &quot;stack1&quot;,
        )
        .set_series_opts(label_opts = opts.LabelOpts(is_show = False))
        .set_global_opts(
            title_opts = opts.TitleOpts(
                pos_left = &quot;left&quot;, title = f&quot;Dept {dept} Average Weekly Sales of All Stores&quot;
            ),
            datazoom_opts = [opts.DataZoomOpts(), opts.DataZoomOpts(type_ = &quot;inside&quot;)],
            xaxis_opts    = opts.AxisOpts(name = &quot;Stores&quot;),
            yaxis_opts    = opts.AxisOpts(name = &quot;Avg. Weekly Sales&quot;, is_scale = True),
            legend_opts   = opts.LegendOpts(
                pos_left = &quot;80%&quot;, pos_top = &quot;top&quot;, align = &quot;left&quot;, orient = &quot;vertical&quot;
            ),
        )
    )
    tab = tab.add(names[str(dept)], f&quot;Dept {dept}&quot;)
tab.render_notebook()
</code></pre>
<iframe allowfullscreen="true" width="100%" height="790px" frameborder="no" src="../post-images/Dept Avg Weekly Sales by Store in Holidays and Nonholidays.html" >
</iframe>
<p>Some departments in different stores show similar pattern. So maybe the department Num. indicates its business scope. Therefore, dept No. might be an important feature.</p>
<h2 id="merge-stores-and-sales">Merge Stores and Sales</h2>
<pre><code class="language-Python">merge = stores.merge(sales, on = ['Store'])
merge.head()
</code></pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store</th>
      <th>Type</th>
      <th>Size</th>
      <th>Dept</th>
      <th>Date</th>
      <th>Weekly_Sales</th>
      <th>IsHoliday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>1</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>24924.50</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>1</td>
      <td nowrap="nowrap">2010-02-12</td>
      <td>46039.49</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>1</td>
      <td nowrap="nowrap">2010-02-19</td>
      <td>41595.55</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>1</td>
      <td nowrap="nowrap">2010-02-26</td>
      <td>19403.54</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>1</td>
      <td nowrap="nowrap">2010-03-05</td>
      <td>21827.90</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-Python">from pyecharts.charts import Page

weekly_sales = sales.groupby([&quot;Store&quot;, &quot;Date&quot;], as_index=False).sum()
store_A      = list(set(merge.loc[merge[&quot;Type&quot;] == &quot;A&quot;][&quot;Store&quot;]))
store_B      = list(set(merge.loc[merge[&quot;Type&quot;] == &quot;B&quot;][&quot;Store&quot;]))
store_C      = list(set(merge.loc[merge[&quot;Type&quot;] == &quot;C&quot;][&quot;Store&quot;]))

page = Page()


def store_sales_by_type(store_list):
    names   = locals()
    overlap = None
    for store in store_list:
        names[str(store)] = (
            Line(init_opts = opts.InitOpts(width = &quot;1000px&quot;))
            .add_xaxis(weekly_sales.loc[weekly_sales[&quot;Store&quot;] == store][&quot;Date&quot;])
            .add_yaxis(
                f&quot;Store {store}&quot;,
                weekly_sales.loc[weekly_sales[&quot;Store&quot;] == store][
                    &quot;Weekly_Sales&quot;
                ].to_list(),
                label_opts     = opts.LabelOpts(is_show = False),
                is_symbol_show = False,
            )
        )
        if overlap is None:
            overlap = names[str(store)]
        else:
            overlap = overlap.overlap(names[str(store)])
    overlap.set_global_opts(
        xaxis_opts = opts.AxisOpts(type_ = &quot;time&quot;, name = &quot;Date&quot;, is_scale = True),
        yaxis_opts = opts.AxisOpts(type_ = &quot;value&quot;, name = &quot;Weekly Sales&quot;, is_scale = True),
    )
    return overlap


l         = [store_A, store_B, store_C]
type_list = [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]
for i in range(len(l)):
    overlap = store_sales_by_type(l[i]).set_global_opts(
        title_opts = opts.TitleOpts(
            pos_left = &quot;left&quot;, title = f&quot;Type {type_list[i]} Stores Weekly Sales&quot;
        ),
        legend_opts = opts.LegendOpts(
            pos_left = &quot;25%&quot;, pos_bottom = &quot;85%&quot;, orient = &quot;vertical&quot;
        ),
        datazoom_opts = [opts.DataZoomOpts(), opts.DataZoomOpts(type_=&quot;inside&quot;)],
    )
    page = page.add(overlap)
page.render_notebook()

# Type A &amp; Type B sales increase at Christmas while Type C sales decrease
</code></pre>
<iframe allowfullscreen="true" width="100%" height="1620px" frameborder="no" src="../post-images/Weekly Sales by Type.html" >
</iframe>
<pre><code class="language-Python">import matplotlib.pyplot as plt
import seaborn as sns

plt.figure(figsize = (14,8))
mean_sale = merge.groupby([&quot;Date&quot;, &quot;Store&quot;, &quot;Type&quot;], as_index = False).mean()
sns.lineplot(data = mean_sale, x = 'Date', y = 'Weekly_Sales', hue = 'Type', ci = None)
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://qingqiuzhang.github.io/post-images/1650662021303.png" alt="" loading="lazy"></figure>
<p>The weekly sales loop around in a periodic way. For stores of type A and type B, the the weekly sales increases a lot during Black Friday and Christmas. While for stores of type C, weekly sales decrease instead during those period. Therefore, date might be important in predicting future weekly sales.</p>
<h2 id="features">Features</h2>
<pre><code class="language-Python">features = pd.read_csv(&quot;Features data set.csv&quot;)
# The format of date is DD/MM/YYYY
features.Date = pd.to_datetime(features.Date, dayfirst=True)
features.shape
features.head(10)
</code></pre>
<pre>(8190, 12)</pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store</th>
      <th>Date</th>
      <th>Temperature</th>
      <th>Fuel_Price</th>
      <th>MarkDown1</th>
      <th>MarkDown2</th>
      <th>MarkDown3</th>
      <th>MarkDown4</th>
      <th>MarkDown5</th>
      <th>CPI</th>
      <th>Unemployment</th>
      <th>IsHoliday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>211.096358</td>
      <td>8.106</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td nowrap="nowrap">2010-02-12</td>
      <td>38.51</td>
      <td>2.548</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>211.242170</td>
      <td>8.106</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td nowrap="nowrap">2010-02-19</td>
      <td>39.93</td>
      <td>2.514</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>211.289143</td>
      <td>8.106</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td nowrap="nowrap">2010-02-26</td>
      <td>46.63</td>
      <td>2.561</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>211.319643</td>
      <td>8.106</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td nowrap="nowrap">2010-03-05</td>
      <td>46.50</td>
      <td>2.625</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>211.350143</td>
      <td>8.106</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td nowrap="nowrap">2010-03-12</td>
      <td>57.79</td>
      <td>2.667</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>211.380643</td>
      <td>8.106</td>
      <td>False</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td nowrap="nowrap">2010-03-19</td>
      <td>54.58</td>
      <td>2.720</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>211.215635</td>
      <td>8.106</td>
      <td>False</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td nowrap="nowrap">2010-03-26</td>
      <td>51.45</td>
      <td>2.732</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>211.018042</td>
      <td>8.106</td>
      <td>False</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td nowrap="nowrap">2010-04-02</td>
      <td>62.27</td>
      <td>2.719</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>210.820450</td>
      <td>7.808</td>
      <td>False</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td nowrap="nowrap">2010-04-09</td>
      <td>65.86</td>
      <td>2.770</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>210.622857</td>
      <td>7.808</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-Python">features.isnull().sum()
features = features.fillna(0)
</code></pre>
<pre>Store              0
Date               0
Temperature        0
Fuel_Price         0
MarkDown1       4158
MarkDown2       5269
MarkDown3       4577
MarkDown4       4726
MarkDown5       4140
CPI              585
Unemployment     585
IsHoliday          0
dtype: int64</pre>
<pre><code class="language-Python">features.info()
</code></pre>
<pre>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 8190 entries, 0 to 8189
Data columns (total 12 columns):
 #   Column        Non-Null Count  Dtype         
---  ------        --------------  -----         
 0   Store         8190 non-null   int64         
 1   Date          8190 non-null   datetime64[ns]
 2   Temperature   8190 non-null   float64       
 3   Fuel_Price    8190 non-null   float64       
 4   MarkDown1     8190 non-null   float64       
 5   MarkDown2     8190 non-null   float64       
 6   MarkDown3     8190 non-null   float64       
 7   MarkDown4     8190 non-null   float64       
 8   MarkDown5     8190 non-null   float64       
 9   CPI           8190 non-null   float64       
 10  Unemployment  8190 non-null   float64       
 11  IsHoliday     8190 non-null   bool          
dtypes: bool(1), datetime64[ns](1), float64(9), int64(1)
memory usage: 712.0 KB
</pre>
<pre><code class="language-Python">features.describe()
</code></pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store</th>
      <th>Temperature</th>
      <th>Fuel_Price</th>
      <th>MarkDown1</th>
      <th>MarkDown2</th>
      <th>MarkDown3</th>
      <th>MarkDown4</th>
      <th>MarkDown5</th>
      <th>CPI</th>
      <th>Unemployment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>8190.000000</td>
      <td>8190.000000</td>
      <td>8190.000000</td>
      <td>8190.000000</td>
      <td>8190.000000</td>
      <td>8190.000000</td>
      <td>8190.000000</td>
      <td>8190.000000</td>
      <td>8190.000000</td>
      <td>8190.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>23.000000</td>
      <td>59.356198</td>
      <td>3.405992</td>
      <td>3462.090725</td>
      <td>1206.981664</td>
      <td>776.464219</td>
      <td>1392.763115</td>
      <td>2043.403725</td>
      <td>160.142180</td>
      <td>7.267762</td>
    </tr>
    <tr>
      <th>std</th>
      <td>12.987966</td>
      <td>18.678607</td>
      <td>0.431337</td>
      <td>7388.916286</td>
      <td>5495.556015</td>
      <td>7539.953758</td>
      <td>4707.111488</td>
      <td>9431.223215</td>
      <td>58.645545</td>
      <td>2.708496</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>-7.290000</td>
      <td>2.472000</td>
      <td>-2781.450000</td>
      <td>-265.760000</td>
      <td>-179.260000</td>
      <td>0.000000</td>
      <td>-185.170000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>12.000000</td>
      <td>45.902500</td>
      <td>3.041000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>131.051167</td>
      <td>6.339000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>23.000000</td>
      <td>60.710000</td>
      <td>3.513000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>140.587450</td>
      <td>7.574000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>34.000000</td>
      <td>73.880000</td>
      <td>3.743000</td>
      <td>4639.585000</td>
      <td>98.590000</td>
      <td>24.220000</td>
      <td>774.692500</td>
      <td>2680.295000</td>
      <td>212.766994</td>
      <td>8.519000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>45.000000</td>
      <td>101.950000</td>
      <td>4.468000</td>
      <td>103184.980000</td>
      <td>104519.540000</td>
      <td>149483.310000</td>
      <td>67474.850000</td>
      <td>771448.100000</td>
      <td>228.976456</td>
      <td>14.313000</td>
    </tr>
  </tbody>
</table>
</div>
<h2 id="merge-stores-sales-and-features">Merge Stores, Sales, and Features</h2>
<pre><code class="language-Python">data = merge.merge(features, on = ['Store','Date','IsHoliday'])
data.shape
data.head()
</code></pre>
<pre>(421570, 16)</pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store</th>
      <th>Type</th>
      <th>Size</th>
      <th>Dept</th>
      <th>Date</th>
      <th>Weekly_Sales</th>
      <th>IsHoliday</th>
      <th>Temperature</th>
      <th>Fuel_Price</th>
      <th>MarkDown1</th>
      <th>MarkDown2</th>
      <th>MarkDown3</th>
      <th>MarkDown4</th>
      <th>MarkDown5</th>
      <th>CPI</th>
      <th>Unemployment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>1</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>24924.50</td>
      <td>False</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>2</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>50605.27</td>
      <td>False</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>3</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>13740.12</td>
      <td>False</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>4</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>39954.04</td>
      <td>False</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>5</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>32229.38</td>
      <td>False</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-Python">corr_mat = data.corr().round(2)
plt.figure(figsize = (15,10))
sns.heatmap(corr_mat, annot=True)
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://qingqiuzhang.github.io/post-images/1650662623575.png" alt="" loading="lazy"></figure>
<pre><code class="language-Python">data.groupby([&quot;Date&quot;, &quot;Store&quot;]).mean()
</code></pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Size</th>
      <th>Dept</th>
      <th>Weekly_Sales</th>
      <th>IsHoliday</th>
      <th>Temperature</th>
      <th>Fuel_Price</th>
      <th>MarkDown1</th>
      <th>MarkDown2</th>
      <th>MarkDown3</th>
      <th>MarkDown4</th>
      <th>MarkDown5</th>
      <th>CPI</th>
      <th>Unemployment</th>
    </tr>
    <tr>
      <th>Date</th>
      <th>Store</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">2010-02-05</th>
      <th>1</th>
      <td>151315.0</td>
      <td>43.616438</td>
      <td>22516.313699</td>
      <td>0.0</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
    <tr>
      <th>2</th>
      <td>202307.0</td>
      <td>44.534247</td>
      <td>29273.828219</td>
      <td>0.0</td>
      <td>40.19</td>
      <td>2.572</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>210.752605</td>
      <td>8.324</td>
    </tr>
    <tr>
      <th>3</th>
      <td>37392.0</td>
      <td>40.615385</td>
      <td>7101.880308</td>
      <td>0.0</td>
      <td>45.71</td>
      <td>2.572</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>214.424881</td>
      <td>7.368</td>
    </tr>
    <tr>
      <th>4</th>
      <td>205863.0</td>
      <td>44.287671</td>
      <td>29248.546164</td>
      <td>0.0</td>
      <td>43.76</td>
      <td>2.598</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>126.442065</td>
      <td>8.623</td>
    </tr>
    <tr>
      <th>5</th>
      <td>34875.0</td>
      <td>39.645161</td>
      <td>5115.695161</td>
      <td>0.0</td>
      <td>39.70</td>
      <td>2.572</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>211.653972</td>
      <td>6.566</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">2012-10-26</th>
      <th>41</th>
      <td>196321.0</td>
      <td>45.055556</td>
      <td>18285.313750</td>
      <td>0.0</td>
      <td>41.80</td>
      <td>3.686</td>
      <td>4864.30</td>
      <td>101.34</td>
      <td>250.60</td>
      <td>47.24</td>
      <td>1524.43</td>
      <td>199.219532</td>
      <td>6.195</td>
    </tr>
    <tr>
      <th>42</th>
      <td>39690.0</td>
      <td>46.365385</td>
      <td>9899.155385</td>
      <td>0.0</td>
      <td>70.50</td>
      <td>4.301</td>
      <td>0.00</td>
      <td>0.75</td>
      <td>2.00</td>
      <td>0.00</td>
      <td>1034.55</td>
      <td>131.193097</td>
      <td>6.943</td>
    </tr>
    <tr>
      <th>43</th>
      <td>41062.0</td>
      <td>46.708333</td>
      <td>12241.740625</td>
      <td>0.0</td>
      <td>69.17</td>
      <td>3.506</td>
      <td>23.68</td>
      <td>7.24</td>
      <td>6.00</td>
      <td>0.00</td>
      <td>815.05</td>
      <td>214.741539</td>
      <td>8.839</td>
    </tr>
    <tr>
      <th>44</th>
      <td>39910.0</td>
      <td>44.818182</td>
      <td>6564.855818</td>
      <td>0.0</td>
      <td>46.97</td>
      <td>3.755</td>
      <td>38.65</td>
      <td>2.61</td>
      <td>0.98</td>
      <td>0.00</td>
      <td>457.74</td>
      <td>131.193097</td>
      <td>5.217</td>
    </tr>
    <tr>
      <th>45</th>
      <td>118221.0</td>
      <td>43.388060</td>
      <td>11347.484030</td>
      <td>0.0</td>
      <td>58.85</td>
      <td>3.882</td>
      <td>4018.91</td>
      <td>58.08</td>
      <td>100.00</td>
      <td>211.94</td>
      <td>858.33</td>
      <td>192.308899</td>
      <td>8.667</td>
    </tr>
  </tbody>
</table>
</div>
<pre><code class="language-Python">mean = data.groupby([&quot;Date&quot;, &quot;Store&quot;, &quot;Type&quot;], as_index = False).mean()
page = Page()


def temp_by_type(store_list):
    names   = locals()
    overlap = None
    for store in store_list:
        names[str(store)] = (
            Line(init_opts = opts.InitOpts(width=&quot;1000px&quot;))
            .add_xaxis(weekly_sales.loc[weekly_sales[&quot;Store&quot;] == store][&quot;Date&quot;])
            .add_yaxis(
                f&quot;Store {store}&quot;,
                mean.loc[mean[&quot;Store&quot;] == store][&quot;Temperature&quot;].to_list(),
                label_opts     = opts.LabelOpts(is_show=False),
                is_symbol_show = False,
            )
        )
        if overlap is None:
            overlap = names[str(store)]
        else:
            overlap = overlap.overlap(names[str(store)])
    overlap.set_global_opts(
        xaxis_opts = opts.AxisOpts(type_=&quot;time&quot;, name=&quot;Date&quot;, is_scale=True),
        yaxis_opts = opts.AxisOpts(type_=&quot;value&quot;, name=&quot;Temperature&quot;, is_scale=True),
    )
    return overlap


for i in range(len(l)):
    overlap = temp_by_type(l[i]).set_global_opts(
        title_opts = opts.TitleOpts(
            pos_left = &quot;left&quot;, title = f&quot;Type {type_list[i]} Stores Temperature&quot;
        ),
        legend_opts = opts.LegendOpts(
            pos_left = &quot;25%&quot;, pos_bottom = &quot;85%&quot;, orient = &quot;vertical&quot;
        ),
        datazoom_opts = [opts.DataZoomOpts(), opts.DataZoomOpts(type_ = &quot;inside&quot;)],
    )
    page = page.add(overlap)
page.render_notebook()
</code></pre>
<iframe allowfullscreen="true" width="100%" height="1620px" frameborder="no" src="../post-images/Temparature by Type.html" >
</iframe>
<pre><code class="language-Python">page = Page()


def fuel_by_type(store_list):
    names = locals()
    overlap = None
    for store in store_list:
        names[str(store)] = (
            Line(init_opts=opts.InitOpts(width=&quot;1000px&quot;))
            .add_xaxis(weekly_sales.loc[weekly_sales[&quot;Store&quot;] == store][&quot;Date&quot;])
            .add_yaxis(
                f&quot;Store {store}&quot;,
                mean.loc[mean[&quot;Store&quot;] == store][&quot;Fuel_Price&quot;].to_list(),
                label_opts=opts.LabelOpts(is_show=False),
                is_symbol_show=False,
            )
        )
        if overlap is None:
            overlap = names[str(store)]
        else:
            overlap = overlap.overlap(names[str(store)])
    overlap.set_global_opts(
        xaxis_opts=opts.AxisOpts(type_=&quot;time&quot;, name=&quot;Date&quot;, is_scale=True),
        yaxis_opts=opts.AxisOpts(type_=&quot;value&quot;, name=&quot;Fuel Price&quot;, is_scale=True),
    )
    return overlap


for i in range(len(l)): 
    overlap = fuel_by_type(l[i]).set_global_opts(
        title_opts = opts.TitleOpts(
            pos_left = &quot;left&quot;, title = f&quot;Type {type_list[i]} Stores Fuel Price&quot;
        ),
        legend_opts = opts.LegendOpts(
            pos_left = &quot;25%&quot;, pos_bottom = &quot;85%&quot;, orient = &quot;vertical&quot;
        ),
        datazoom_opts = [opts.DataZoomOpts(), opts.DataZoomOpts(type_ = &quot;inside&quot;)],
    )
    page = page.add(overlap)
page.render_notebook()
</code></pre>
<iframe allowfullscreen="true" width="100%" height="1620px" frameborder="no" src="../post-images/Fuel Price by Type.html" >
</iframe>
<pre><code class="language-Python">page = Page()


def cpi_by_type(store_list):
    names = locals()
    overlap = None
    for store in store_list:
        names[str(store)] = (
            Line(init_opts = opts.InitOpts(width = &quot;1000px&quot;))
            .add_xaxis(weekly_sales.loc[weekly_sales[&quot;Store&quot;] == store][&quot;Date&quot;])
            .add_yaxis(
                f&quot;Store {store}&quot;,
                mean.loc[mean[&quot;Store&quot;] == store][&quot;CPI&quot;].to_list(),
                label_opts = opts.LabelOpts(is_show=False),
                is_symbol_show = False,
            )
        )
        if overlap is None:
            overlap = names[str(store)]
        else:
            overlap = overlap.overlap(names[str(store)])
    overlap.set_global_opts(
        xaxis_opts = opts.AxisOpts(type_ = &quot;time&quot;, name = &quot;Date&quot;, is_scale = True),
        yaxis_opts = opts.AxisOpts(type_ = &quot;value&quot;, name = &quot;CPI&quot;, is_scale = True),
    )
    return overlap


for i in range(len(l)):
    overlap = cpi_by_type(l[i]).set_global_opts(
        title_opts = opts.TitleOpts(
            pos_left = &quot;left&quot;, title = f&quot;Type {type_list[i]} Stores CPI&quot;
        ),
        legend_opts = opts.LegendOpts(
            pos_left = &quot;25%&quot;, pos_bottom = &quot;85%&quot;, orient = &quot;vertical&quot;
        ),
        datazoom_opts = [opts.DataZoomOpts(), opts.DataZoomOpts(type_=&quot;inside&quot;)],
    )
    page = page.add(overlap)
page.render_notebook()
</code></pre>
<iframe allowfullscreen="true" width="100%" height="1620px" frameborder="no" src="../post-images/CPI by Type.html" >
</iframe>
<pre><code class="language-Python">page = Page()


def unemploy_by_type(store_list): 
    names   = locals()
    overlap = None
    for store in store_list: 
        names[str(store)] = (
            Line(init_opts = opts.InitOpts(width = &quot;1000px&quot;))
            .add_xaxis(weekly_sales.loc[weekly_sales[&quot;Store&quot;] == store][&quot;Date&quot;])
            .add_yaxis(
                f&quot;Store {store}&quot;,
                mean.loc[mean[&quot;Store&quot;] == store][&quot;Unemployment&quot;].to_list(),
                label_opts     = opts.LabelOpts(is_show=False),
                is_symbol_show = False,
            )
        )
        if overlap is None: 
            overlap = names[str(store)]
        else: 
            overlap = overlap.overlap(names[str(store)])
    overlap.set_global_opts(
        xaxis_opts = opts.AxisOpts(type_ = &quot;time&quot;, name = &quot;Date&quot;, is_scale = True),
        yaxis_opts = opts.AxisOpts(
            type_ = &quot;value&quot;, name = &quot;Unemployment Rate&quot;, is_scale = True
        ),
    )
    return overlap


for i in range(len(l)):
    overlap = unemploy_by_type(l[i]).set_global_opts(
        title_opts = opts.TitleOpts(
            pos_left = &quot;left&quot;, title = f&quot;Type {type_list[i]} Stores Unemployment Rate&quot;
        ),
        legend_opts = opts.LegendOpts(
            pos_left = &quot;35%&quot;, pos_bottom = &quot;80%&quot;, orient = &quot;vertical&quot;
        ),
        datazoom_opts = [opts.DataZoomOpts(), opts.DataZoomOpts(type_ = &quot;inside&quot;)],
    )
    page = page.add(overlap)
page.render_notebook()
</code></pre>
<iframe allowfullscreen="true" width="100%" height="1620px" frameborder="no" src="../post-images/Unemployment Rete by Type.html" >
</iframe>
<p>Temperature, fuel price, CPI, unemployment rate are differnt for stores, but the same for deparments in one store. So the stores are randomly chosen from various places.</p>
<h1 id="feature-engineer">Feature Engineer</h1>
<pre><code class="language-Python">data.head()
</code></pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store</th>
      <th>Type</th>
      <th>Size</th>
      <th>Dept</th>
      <th>Date</th>
      <th>Weekly_Sales</th>
      <th>IsHoliday</th>
      <th>Temperature</th>
      <th>Fuel_Price</th>
      <th>MarkDown1</th>
      <th>MarkDown2</th>
      <th>MarkDown3</th>
      <th>MarkDown4</th>
      <th>MarkDown5</th>
      <th>CPI</th>
      <th>Unemployment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>1</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>24924.50</td>
      <td>False</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>2</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>50605.27</td>
      <td>False</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>3</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>13740.12</td>
      <td>False</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>4</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>39954.04</td>
      <td>False</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>5</td>
      <td nowrap="nowrap">2010-02-05</td>
      <td>32229.38</td>
      <td>False</td>
      <td>42.31</td>
      <td>2.572</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>211.096358</td>
      <td>8.106</td>
    </tr>
  </tbody>
</table>
</div>
<p>Since more than half rows of the dataset contains missing values for columns MarkDown1 - MarkDown5. Thus, it's not very practical to simulate data for missing values. We choose to firstly drop the rows where the values of MarkDown1 - MarkDown5 are null. One of the methods is to build various machine learning models to evaluate if markdown variables are important explanatory variables to predict weekly_sales.</p>
<pre><code class="language-Python"># Using data where MarkDown1-5 is not null to build Machine Learning models
df = data[(data.MarkDown1!=0)&amp;(data.MarkDown2!=0)&amp;(data.MarkDown3!=0)
          &amp;(data.MarkDown4!=0)&amp;(data.MarkDown5!=0)]
df
</code></pre>
<div style="overflow: auto; width: 100%">
<table border="1">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Store</th>
      <th>Type</th>
      <th>Size</th>
      <th>Dept</th>
      <th>Date</th>
      <th>Weekly_Sales</th>
      <th>IsHoliday</th>
      <th>Temperature</th>
      <th>Fuel_Price</th>
      <th>MarkDown1</th>
      <th>MarkDown2</th>
      <th>MarkDown3</th>
      <th>MarkDown4</th>
      <th>MarkDown5</th>
      <th>CPI</th>
      <th>Unemployment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6587</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>1</td>
      <td nowrap="nowrap">2011-11-11</td>
      <td>18689.54</td>
      <td>False</td>
      <td>59.11</td>
      <td>3.297</td>
      <td>10382.90</td>
      <td>6115.67</td>
      <td>215.07</td>
      <td>2406.62</td>
      <td>6551.42</td>
      <td>217.998085</td>
      <td>7.866</td>
    </tr>
    <tr>
      <th>6588</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>2</td>
      <td nowrap="nowrap">2011-11-11</td>
      <td>44936.47</td>
      <td>False</td>
      <td>59.11</td>
      <td>3.297</td>
      <td>10382.90</td>
      <td>6115.67</td>
      <td>215.07</td>
      <td>2406.62</td>
      <td>6551.42</td>
      <td>217.998085</td>
      <td>7.866</td>
    </tr>
    <tr>
      <th>6589</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>3</td>
      <td nowrap="nowrap">2011-11-11</td>
      <td>9959.64</td>
      <td>False</td>
      <td>59.11</td>
      <td>3.297</td>
      <td>10382.90</td>
      <td>6115.67</td>
      <td>215.07</td>
      <td>2406.62</td>
      <td>6551.42</td>
      <td>217.998085</td>
      <td>7.866</td>
    </tr>
    <tr>
      <th>6590</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>4</td>
      <td nowrap="nowrap">2011-11-11</td>
      <td>36826.52</td>
      <td>False</td>
      <td>59.11</td>
      <td>3.297</td>
      <td>10382.90</td>
      <td>6115.67</td>
      <td>215.07</td>
      <td>2406.62</td>
      <td>6551.42</td>
      <td>217.998085</td>
      <td>7.866</td>
    </tr>
    <tr>
      <th>6591</th>
      <td>1</td>
      <td>A</td>
      <td>151315</td>
      <td>5</td>
      <td nowrap="nowrap">2011-11-11</td>
      <td>31002.65</td>
      <td>False</td>
      <td>59.11</td>
      <td>3.297</td>
      <td>10382.90</td>
      <td>6115.67</td>
      <td>215.07</td>
      <td>2406.62</td>
      <td>6551.42</td>
      <td>217.998085</td>
      <td>7.866</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>421565</th>
      <td>45</td>
      <td>B</td>
      <td>118221</td>
      <td>93</td>
      <td nowrap="nowrap">2012-10-26</td>
      <td>2487.80</td>
      <td>False</td>
      <td>58.85</td>
      <td>3.882</td>
      <td>4018.91</td>
      <td>58.08</td>
      <td>100.00</td>
      <td>211.94</td>
      <td>858.33</td>
      <td>192.308899</td>
      <td>8.667</td>
    </tr>
    <tr>
      <th>421566</th>
      <td>45</td>
      <td>B</td>
      <td>118221</td>
      <td>94</td>
      <td nowrap="nowrap">2012-10-26</td>
      <td>5203.31</td>
      <td>False</td>
      <td>58.85</td>
      <td>3.882</td>
      <td>4018.91</td>
      <td>58.08</td>
      <td>100.00</td>
      <td>211.94</td>
      <td>858.33</td>
      <td>192.308899</td>
      <td>8.667</td>
    </tr>
    <tr>
      <th>421567</th>
      <td>45</td>
      <td>B</td>
      <td>118221</td>
      <td>95</td>
      <td nowrap="nowrap">2012-10-26</td>
      <td>56017.47</td>
      <td>False</td>
      <td>58.85</td>
      <td>3.882</td>
      <td>4018.91</td>
      <td>58.08</td>
      <td>100.00</td>
      <td>211.94</td>
      <td>858.33</td>
      <td>192.308899</td>
      <td>8.667</td>
    </tr>
    <tr>
      <th>421568</th>
      <td>45</td>
      <td>B</td>
      <td>118221</td>
      <td>97</td>
      <td nowrap="nowrap">2012-10-26</td>
      <td>6817.48</td>
      <td>False</td>
      <td>58.85</td>
      <td>3.882</td>
      <td>4018.91</td>
      <td>58.08</td>
      <td>100.00</td>
      <td>211.94</td>
      <td>858.33</td>
      <td>192.308899</td>
      <td>8.667</td>
    </tr>
    <tr>
      <th>421569</th>
      <td>45</td>
      <td>B</td>
      <td>118221</td>
      <td>98</td>
      <td nowrap="nowrap">2012-10-26</td>
      <td>1076.80</td>
      <td>False</td>
      <td>58.85</td>
      <td>3.882</td>
      <td>4018.91</td>
      <td>58.08</td>
      <td>100.00</td>
      <td>211.94</td>
      <td>858.33</td>
      <td>192.308899</td>
      <td>8.667</td>
    </tr>
  </tbody>
</table>
</div>
                                </div>
                                
                                    <div class="post-toc">
                                        <ul class="markdownIt-TOC">
<li><a href="#exploring-data">Exploring Data</a>
<ul>
<li><a href="#stores">Stores</a></li>
<li><a href="#sales">Sales</a></li>
<li><a href="#merge-stores-and-sales">Merge Stores and Sales</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#merge-stores-sales-and-features">Merge Stores, Sales, and Features</a></li>
</ul>
</li>
<li><a href="#feature-engineer">Feature Engineer</a></li>
</ul>

                                    </div>
                                    
                                        
                                                            
                                                                <!--en-->
                                                                <section class="post-tags en ">
                                                                    <div>
                                                                        <span>Tag(s):</span>
                                                                        <span class="tag ">
                                                                            
                                                                                
                                                                                    <a href="https://qingqiuzhang.github.io/WOUmPg0ZPX/">#
                                                                                        Python
                                                                                    </a>
                                                                                    
                                                                                    <a href="https://qingqiuzhang.github.io/-cFBAkweb/">#
                                                                                        Regression
                                                                                    </a>
                                                                                    
                                                                                    <a href="https://qingqiuzhang.github.io/URtsfZ1k8/">#
                                                                                        Machine Learning
                                                                                    </a>
                                                                                    
                                                                                        
                                                                        </span>
                                                                    </div>
                                                                    <div>
                                                                        <a
                                                                            href="javascript:window.history.back();">back</a>
                                                                        <span>&dot;</span>
                                                                        <a href="#">home</a>
                                                                    </div>
                                                                </section>
                                                                
                                                                        <!---->
                                                                        <section class="post-nav">
                                                                            
                                                                                    
                                                                                        <a class="next" rel="next"
                                                                                            href="https://qingqiuzhang.github.io/diabetes-dataset-report-2-model-training-evaluating-and-testing/">
                                                                                            Diabetes Data Analytics (2) -- Model Training, Evaluating and Testing
                                                                                        </a>
                                                                                        
                                                                        </section>
                    </article>
                </div>
                
                    
                        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container" style="width: 100%;max-width: 780px;margin: auto;"></div>

<script>
    var gitalk = new Gitalk({
        clientID: '689fd1fc8fe8ddae1804',
        clientSecret: '216656a758024efe4573879934956b305a43a693',
        repo: 'qingqiuzhang.github.io',
        owner: 'qingqiuzhang',
        admin: ['qingqiuzhang'],
        id: (location.pathname).substring(0, 49), // Ensure uniqueness and length less than 50
        distractionFreeMode: false // Facebook-like distraction free mode
    })

    gitalk.render('gitalk-container')
</script>
                            
                                        
                                            
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                        
                            
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        Qingqiu Zhang &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://github.com" target="_blank">
                                                Github
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.6
                </div>
                
                    <script>
                        var port = '';
                        
                        port = ':4000';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
            <script src='https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js'></script>
            
                <script>
                    
                    
                    loadlive2d();
                    
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1650669377469);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>